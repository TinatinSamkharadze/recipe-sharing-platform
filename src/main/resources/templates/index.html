<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Recipe Share</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<header>
    <div class="container">
        <h1>Recipe Share</h1>
        <nav>
            <ul>
                <li><a th:href="@{/}">Home</a></li>
                <li><a th:href="@{/recipe/new}">Create Recipe</a></li>
                <li><a th:href="@{/about}">About</a></li>
            </ul>
        </nav>
        <form th:action="@{/search}" method="get" class="search-form">
            <input type="text" name="query" placeholder="Search recipes">
            <button type="submit">Search</button>
        </form>
    </div>
</header>

<main class="container">
    <div class="sidebar">
        <div class="categories">
            <h2>Categories</h2>
            <ul>
                <li th:each="category : ${categories}">
                    <a th:href="@{/category/{id}(id=${category.id})}" th:text="${category.name}"></a>
                    <span class="count" th:text="'(' + ${category.recipeCount} + ')'"></span>
                </li>
            </ul>
            <div class="view-all">
                <a th:href="@{/categories}">View All Categories</a>
            </div>
        </div>
    </div>

    <div class="content">
        <h1>Latest Recipes</h1>

        <!-- Debugging information -->
        <div th:if="${recipes.isEmpty()}" style="color: red; margin-bottom: 20px;">
            No recipes found. Total count in database: <span th:text="${recipeService != null ? recipeService.totalNumberOfRecipes() : 'N/A'}"></span>
        </div>

        <div class="recipe-grid">
            <div th:each="recipe : ${recipes}" class="recipe-card">
                <div class="recipe-image">
                    <img th:if="${!recipe.images.isEmpty()}" th:src="${recipe.images[0].path}" alt="Recipe Image">
                    <img th:if="${recipe.images.isEmpty()}" src="/images/default-recipe.jpg" alt="Default Recipe Image">
                </div>
                <div class="recipe-info">
                    <h3>
                        <a th:href="@{/recipe/{id}(id=${recipe.id})}" th:text="${recipe.title}"></a>
                    </h3>
                    <div class="recipe-meta">
                        <span class="author" th:text="'By ' + ${recipe.author}"></span>
                        <span class="time" th:text="${recipe.prettyCreateTime}"></span>
                        <span class="category" th:if="${recipe.categoryName != null}">
                                <a th:href="@{/category/{id}(id=${recipe.categoryId})}" th:text="${recipe.categoryName}"></a>
                            </span>
                    </div>
                    <p th:text="${recipe.excerpt}"></p>
                    <div class="recipe-footer">
                            <span class="cooking-time">
                                <i class="icon-clock"></i>
                                <span th:text="${recipe.cookingTime} + ' min'"></span>
                            </span>
                        <span class="difficulty" th:text="${recipe.difficulty}"></span>
                        <span class="servings" th:text="${recipe.servingSize} + ' servings'"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="pagination" th:if="${totalPages > 1}">
            <a th:if="${page > 0}" th:href="@{/(page=${page-1})}" class="prev">Previous</a>
            <span class="current-page" th:text="${page + 1}"></span>
            <span> of </span>
            <span th:text="${totalPages}"></span>
            <a th:if="${page < totalPages - 1}" th:href="@{/(page=${page+1})}" class="next">Next</a>
        </div>
    </div>
</main>

<footer>
    <div class="container">
        <p>&copy; 2025 Recipe Share. All rights reserved.</p>
    </div>
</footer>
</body>
</html>